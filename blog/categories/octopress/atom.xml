<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Octopress | Hiro Fukami's Blog]]></title>
  <link href="http://hirofukami.com/blog/categories/octopress/atom.xml" rel="self"/>
  <link href="http://hirofukami.com/"/>
  <updated>2015-02-16T22:45:19+09:00</updated>
  <id>http://hirofukami.com/</id>
  <author>
    <name><![CDATA[HiroFukami]]></name>
    <email><![CDATA[dee.sea@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[WordPress to Octopress 日本語パーマリンクを直す]]></title>
    <link href="http://hirofukami.com/blog/2015/02/15/permalink-wordpress-to-octopress/"/>
    <updated>2015-02-15T20:00:00+09:00</updated>
    <id>http://hirofukami.com/blog/2015/02/15/permalink-wordpress-to-octopress</id>
    <content type="html"><![CDATA[<p><a href="/blog/2014/12/01/right-way-wordpress-to-octopress/">WordPressからOctopressにきれいに移行する方法を紹介した</a>が、ちょっとした問題が残っていて、それを解消したので紹介。</p>

<h2>パーマリンクの扱い</h2>

<p>パーマリンクはWordPressの管理画面のパーマリンク設定でカスタマイズできるので、</p>

<p><code>/%year%/%monthnum%/%day%/%postname%.html</code></p>

<p>として設定していました。</p>

<p>それを <a href="/blog/2014/12/01/right-way-wordpress-to-octopress/">紹介した方法で</a> やると以下の様な markdown ファイルが生成されました。</p>

<h2>```</h2>

<p>title: 仕事で本当に大切にしたいこと
date: Mon, 26 Jul 2004 15:00:00 +0000
author: Hiro Fukami
layout: post
permalink: /2004/07/26/%e4%bb%95%e4%ba%8b%e3%81%a7%e6%9c%ac%e5%bd%93%e3%81%ab%e5%a4%a7%e5%88%87%e3%81%ab%e3%81%97%e3%81%9f%e3%81%84%e3%81%93%e3%81%a8/
tumblr_hirofukami_permalink:
  &ndash; <a href="http://hirofukami.tumblr.com/post/29542403177">http://hirofukami.tumblr.com/post/29542403177</a>
tumblr_hirofukami_id:
  &ndash; 29542403177
original_post_id:
  &ndash; 741
categories:
  &ndash; Book
tags:
  &ndash; book</p>

<h2>  &ndash; reivew</h2>

<p>```</p>

<p>WordPressパーマリンクでポスト名を日本語で書くと、Octopressのヘッダ内、<code>permalink</code>にURLエンコードされた文字列が並びます。</p>

<h2>問題点</h2>

<p>この<code>permalink</code>をOctopress上でみると、アーカイブやポスト一覧には並びますが、個別ポストのURLは <code>/2004/07/26/仕事で本当に大切にしたいこと/</code> になり、個別ポストのリンクを開くと真っ白になってしまいます。</p>

<p>どうやら、正しく Octopress 上でエンコード・デコードの変換ができないまま html を生成しているみたいです。</p>

<h2>とりあえずさくっと解決する方法</h2>

<p>せっかくリンクは作れているのに個別ポストが見れないのはよろしくないので、手っ取り早く解決したいところ。</p>

<ul>
<li>まずは個別ポストが見れるように、パーマリンクに日本語エンコードした文字列はやめて英語に変更する</li>
<li>permalink にポスト名を入れるこだわりを捨てる</li>
</ul>


<p>1ポストずつ日本語URLエンコードされている部分を変更するのも手間なので、複数ファイル同時に置換した。</p>

<p>テキストエディターは <a href="http://www.sublimetext.com/">Sublimi Text</a> を使っているので、その置換方法を紹介します。</p>

<p><code>Shift + Command + F</code> の全ファイル置換設定画面を出して、正規表現を有効にして以下のように入力。</p>

<p>{% img /images/2015/02/20150215-sublime-text-screenshot.png Sublime Text Screen Shot %}</p>

<ul>
<li><code>^(permalink: /..../../..)/%(..).*/$</code> のように日付の部分までマッチさせたものを格納してReplaceの$1で使う</li>
<li>同じ日付のポストがあっても被りづらいようにエンコード1文字目を格納してReplaceの$2で使う

<ul>
<li>同じ日付で複数ポストしていないのなら、$2 の部分は不要</li>
</ul>
</li>
<li>source/_posts/ 配下の全ファイルに対して</li>
</ul>


<p>Replace ボタンを押すと置換されます。</p>

<p>先ほどのポストの permalink の部分は以下のように変わります。</p>

<p><code>permalink: /2004/07/26/post-e4/</code></p>

<p>あとは、<code>rake generate &amp;&amp; rake preview</code> で確認して、<code>rake deploy</code> でサイトに反映。</p>

<p>ということでした。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[WordPressからOctopressへきれいに移行する方法]]></title>
    <link href="http://hirofukami.com/blog/2014/12/01/right-way-wordpress-to-octopress/"/>
    <updated>2014-12-01T20:00:00+09:00</updated>
    <id>http://hirofukami.com/blog/2014/12/01/right-way-wordpress-to-octopress</id>
    <content type="html"><![CDATA[<p><img src="/images/20141201-octopress.png" alt="octopress" /></p>

<p>自分のブログ <a href="http://hirofukami.com">hirofukami.com</a> は今、Octopress on <a href="https://pages.github.com/">Github Pages</a> で動いています。</p>

<p>その前は自分サーバ上で WordPress を運用していたのですが、アップデートがめんどい、もうちょっとすっきり運用したい、あとOctopress結構クールじゃん(これが大きい)とか思って <a href="http://octopress.org/">Octopress</a> に移行しました。</p>

<p>今までブログは以下のように渡り歩いてきたのですが、今までのポストは全て移行して蓄積してきました。</p>

<ol>
<li>はてなダイアリー</li>
<li>Tumblr</li>
<li>WordPress.com</li>
<li>WordPress on 自分サーバ</li>
<li>Octopress on Github Pages</li>
</ol>


<p>2002年12月が最初のポストで、12年間で738ポストあります。
今回の移行も今までどおり全ポストを WordPress から Octopress に移行するためにあれこれやってみたのですが、Webに載っている方法でベストなものがなかったので、少しだけいじってきれいに移行できたというお話です。</p>

<!-- more -->


<h2>Webに載っている方法たち</h2>

<p>Octopress の元になっている <a href="http://import.jekyllrb.com/">Jekyll</a> には<a href="http://import.jekyllrb.com/docs/wordpress/">WordPressからの移行方法も紹介しているページ</a>があったり、検索すると出てきたりして3つほど試してみた。</p>

<h3>1. WordPress to Jekyll Exporter</h3>

<p>Github から取得可能 <a href="https://github.com/benbalter/wordpress-to-jekyll-exporter">https://github.com/benbalter/wordpress-to-jekyll-exporter</a></p>

<p>さすがに wordpress.org のプラグインには登録されていない。</p>

<p>WordPress プラグインとしてインストールして、WordPress管理画面上で操作する。
全てのポストを <code>.md</code> ファイルに変換してくれる。</p>

<p>動作は問題ないのだけど、生成された <code>.md</code> ファイルを見ると、最初の行のyaml front matterが以下のようになっている。</p>

<h2>```</h2>

<p>title: 仕事で本当に大切にしたいこと
author: Hiro Fukami
layout: post
permalink: /2004/07/26/%e4%bb%95%e4%ba%8b%e3%81%a7%e6%9c%ac%e5%bd%93%e3%81%ab%e5%a4%a7%e5%88%87%e3%81%ab%e3%81%97%e3%81%9f%e3%81%84%e3%81%93%e3%81%a8/
tumblr_hirofukami_permalink:
  &ndash; <a href="http://hirofukami.tumblr.com/post/29542403177">http://hirofukami.tumblr.com/post/29542403177</a>
tumblr_hirofukami_id:
  &ndash; 29542403177
original_post_id:
  &ndash; 741
categories:
  &ndash; Book
tags:
  &ndash; book</p>

<h2>  &ndash; reivew</h2>

<p>```</p>

<p>日付(date)がない。。。</p>

<p>試しに <code>rake generate</code> からの <code>rake preview</code> で見てみると、確かに日付が表示されない。日付がわからないのはブログとしてダメだ。何とかせねば。</p>

<h3>2. jekyll-import</h3>

<p><a href="http://import.jekyllrb.com/docs/wordpress/">Jekyllのページに紹介されていて</a> ruby の gem で提供されれている。</p>

<p>ソース : <a href="https://github.com/jekyll/jekyll-import/tree/v0.4.1">https://github.com/jekyll/jekyll-import/tree/v0.4.1</a></p>

<p>WordPress の動いているサーバ上で実行させるようなのだけど、うまく動かなかった。</p>

<h3>3. Exitwp</h3>

<p>もっと他にないのかと思って調べて見つけたもの。</p>

<p>ソース : <a href="https://github.com/thomasf/exitwp">https://github.com/thomasf/exitwp</a></p>

<p>WordPress管理画面からexportツールを使ってxmlファイルで出力させて、それを python スクリプトで変換してくれるもの。</p>

<p>XMLファイルを落として、手元のMacで実行してみたが色々足りないよエラーが出て、あまりMacにインストールしたくない派の自分としてはここでストップした。</p>

<h2>結局、WordPress to Jekyll Exporter に1行足すだけで解決した</h2>

<p>WordPress to Jekyll Exporter のソースを見てみると、jekyll-export.php の中で yaml front matterの部分をWordPress関数から持ってきている部分があり、そこに WordPress 関数の <code>get_the_time</code> を足したらうまく日付が加わった。</p>

<h2>```</h2>

<p>title: 仕事で本当に大切にしたいこと
date: Mon, 26 Jul 2004 15:00:00 +0000
author: Hiro Fukami
layout: post
permalink: /2004/07/26/%e4%bb%95%e4%ba%8b%e3%81%a7%e6%9c%ac%e5%bd%93%e3%81%ab%e5%a4%a7%e5%88%87%e3%81%ab%e3%81%97%e3%81%9f%e3%81%84%e3%81%93%e3%81%a8/
tumblr_hirofukami_permalink:
  &ndash; <a href="http://hirofukami.tumblr.com/post/29542403177">http://hirofukami.tumblr.com/post/29542403177</a>
tumblr_hirofukami_id:
  &ndash; 29542403177
original_post_id:
  &ndash; 741
categories:
  &ndash; Book
tags:
  &ndash; book</p>

<h2>  &ndash; reivew</h2>

<p>```</p>

<p>preview もOK。日付のフォーマットは調べたらOctopress側でも変更する必要なく解釈できるようだったので、シンプルな1行になった。</p>

<p><code>'date' =&gt; get_the_time( 'r', $post ),</code></p>

<p>差分は<a href="https://github.com/d-sea/wordpress-to-jekyll-exporter/commit/50b7a10276dd8f799558502e8f4a0b7462968188">こちら</a></p>

<p><a href="https://github.com/d-sea/wordpress-to-jekyll-exporter">Github で fork している</a>ので、使い方はご自由にどうぞ。</p>

<p>OK、OK。思っていた通りに移行できた。すっきりした。</p>

<p>良き Octopress Blog ライフを〜</p>

<h2>追記</h2>

<p>日本語エンコードされた文字の入ったパーマリンクだと、個別ページが真っ白になって見れなくなる事象がでたため、それを <a href="/blog/2015/02/15/permalink-wordpress-to-octopress/">解消したポストを書きました</a>。</p>

<p><strong><a href="/blog/2015/02/15/permalink-wordpress-to-octopress/">WordPress to Octopress 日本語パーマリンクを直す</a></strong></p>

<p>良かったら読んでやってください。</p>
]]></content>
  </entry>
  
</feed>
